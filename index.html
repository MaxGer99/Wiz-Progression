<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard101 Progression Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: transparent;
            color: #ffffff;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .progress-section {
            margin-bottom: 20px;
        }

        .progress-label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: rgba(50, 50, 50, 0.8);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4a90e2, #63b3ed);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        #worldProgress .progress-bar {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
        }

        #totalProgress .progress-bar {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .current-quest {
            margin-bottom: 20px;
        }

        .current-quest-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            color: #63b3ed;
        }

        .current-quest-text {
            background: rgba(30, 30, 30, 0.8);
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #63b3ed;
            font-size: 15px;
            line-height: 1.4;
            min-height: 50px;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }

        .current-quest-text:hover {
            background: rgba(40, 40, 40, 0.9);
            transform: scale(1.02);
        }

        .current-quest-text:active {
            transform: scale(0.98);
        }

        .counter-section {
            margin-top: 20px;
        }

        .counter-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            color: #f39c12;
        }

        .counter-display {
            background: rgba(30, 30, 30, 0.8);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        /* Control panel for easy updates */
        .control-panel {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
        }

        .control-panel h3 {
            margin-bottom: 15px;
            color: #63b3ed;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #bbb;
        }

        .control-group input,
        .control-group textarea {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(50, 50, 50, 0.8);
            color: #ffffff;
            font-family: inherit;
            font-size: 14px;
        }

        .control-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .control-group input[type="number"] {
            width: 100px;
        }

        button {
            background: linear-gradient(90deg, #4a90e2, #63b3ed);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .toggle-controls {
            margin-bottom: 15px;
        }

        .control-group select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(50, 50, 50, 0.8);
            color: #ffffff;
            font-family: inherit;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- World Progress Bar -->
        <div class="progress-section" id="worldProgress">
            <div class="progress-label">
                <span id="worldLabel">World Progress</span>
                <span id="worldPercentage">0%</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="worldBar" style="width: 0%;">
                    <span id="worldBarText"></span>
                </div>
            </div>
        </div>

        <!-- Total Progress Bar -->
        <div class="progress-section" id="totalProgress">
            <div class="progress-label">
                <span id="totalLabel">Total Progression</span>
                <span id="totalPercentage">0%</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="totalBar" style="width: 0%;">
                    <span id="totalBarText"></span>
                </div>
            </div>
        </div>

        <!-- Current Quest -->
        <div class="current-quest">
            <div class="current-quest-label">Current Quest (click to advance):</div>
            <div style="display: flex; gap: 10px; align-items: stretch;">
                <div class="current-quest-text" id="currentQuest" onclick="advanceToNextQuest()" style="flex: 1;">
                    Loading quest information...
                </div>
                <button onclick="goBackQuest()" style="padding: 12px 15px; white-space: nowrap;">‚Üê Back</button>
            </div>
        </div>

        <!-- Counter -->
        <div class="counter-section">
            <div class="counter-label" id="counterLabel">Counter:</div>
            <div class="counter-display" id="counterValue">0</div>
        </div>

        <!-- Control Panel (hide this in OBS by adjusting the crop) -->
        <div class="control-panel">
            <button class="toggle-controls" onclick="toggleControls()">Toggle Controls</button>
            
            <div id="controls" style="display: none;">
                <h3>Update Overlay</h3>
                
                <div class="control-group">
                    <label for="worldSelect">Select World:</label>
                    <select id="worldSelect" onchange="onWorldChange()">
                        <option value="">-- Choose a World --</option>
                        <option value="Wizard City">Wizard City</option>
                        <option value="Krokotopia">Krokotopia</option>
                        <option value="Marleybone">Marleybone</option>
                        <option value="Mooshu">Mooshu</option>
                        <option value="Dragonspyre">Dragonspyre</option>
                        <option value="Celestia">Celestia</option>
                        <option value="Zafaria">Zafaria</option>
                        <option value="Avalon">Avalon</option>
                        <option value="Azteca">Azteca</option>
                        <option value="Khrysalis">Khrysalis</option>
                        <option value="Polaris">Polaris</option>
                        <option value="Mirage">Mirage</option>
                        <option value="Empyrea">Empyrea</option>
                        <option value="Karamelle">Karamelle</option>
                        <option value="Lemuria">Lemuria</option>
                        <option value="Novus">Novus</option>
                        <option value="Wallaru">Wallaru</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="worldCurrent">World Progress (current):</label>
                    <input type="number" id="worldCurrent" min="0" value="0">
                </div>

                <div class="control-group">
                    <label for="worldTotal">World Progress (total):</label>
                    <input type="number" id="worldTotal" min="1" value="100">
                </div>

                <div class="control-group">
                    <label for="totalCurrent">Total Progress (current):</label>
                    <input type="number" id="totalCurrent" min="0" value="0">
                </div>

                <div class="control-group">
                    <label for="totalTotal">Total Progress (total):</label>
                    <input type="number" id="totalTotal" min="1" value="100">
                </div>

                <div class="control-group">
                    <label for="questSelect">Current Quest:</label>
                    <select id="questSelect" onchange="onQuestChange()">
                        <option value="">-- Select Current Quest --</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="questText">Or Enter Custom Quest Name:</label>
                    <textarea id="questText" placeholder="Enter the current quest name...">Unicorn Way</textarea>
                </div>

                <div class="control-group">
                    <label for="counterText">Counter Label:</label>
                    <input type="text" id="counterText" placeholder="e.g., Deaths, Battles" value="Re-Rolls">
                </div>

                <div class="control-group">
                    <label for="counterNum">Counter Value:</label>
                    <input type="number" id="counterNum" min="0" value="0">
                </div>

                <button onclick="updateOverlay()">Update Display</button>
            </div>
        </div>
    </div>

    <script>
        let questDatabase = {};
        let worlds = {};

        // Load quest data from JSON file
        async function loadQuestData() {
            try {
                const response = await fetch('quests.json');
                const data = await response.json();
                questDatabase = data.questDatabase;
                worlds = data.worldTotals;
            } catch (error) {
                console.error('Error loading quest data:', error);
                // Fallback to default data if JSON fails to load
                initializeDefaultData();
            }
        }

        function initializeDefaultData() {
            questDatabase = {
                'Wizard City': ['Unicorn Way', 'Ghost Hunters', 'Skeleton Crew'],
                'Krokotopia': ['Welcome to Krok', 'Finding Sophia']
            };
            worlds = {
                'Wizard City': 39,
                'Krokotopia': 11
            };
        }

        function onWorldChange() {
            const world = document.getElementById('worldSelect').value;
            if (world && worlds[world]) {
                document.getElementById('worldTotal').value = worlds[world];
                // Populate quest dropdown
                populateQuestDropdown(world);
            }
        }

        function populateQuestDropdown(world) {
            const questSelect = document.getElementById('questSelect');
            questSelect.innerHTML = '<option value="">-- Select Current Quest --</option>';
            
            if (questDatabase[world]) {
                questDatabase[world].forEach((quest, index) => {
                    const option = document.createElement('option');
                    const questName = typeof quest === 'string' ? quest : quest.name;
                    const questType = typeof quest === 'string' ? '' : (quest.type ? ` [${quest.type}]` : '');
                    option.value = questName;
                    option.textContent = `${index + 1}. ${questName}${questType}`;
                    questSelect.appendChild(option);
                });
            }
        }

        function onQuestChange() {
            const world = document.getElementById('worldSelect').value;
            const questSelect = document.getElementById('questSelect');
            const selectedQuest = questSelect.value;
            
            if (world && selectedQuest && questDatabase[world]) {
                const questIndex = questDatabase[world].findIndex(q => {
                    const qName = typeof q === 'string' ? q : q.name;
                    return qName === selectedQuest;
                });
                if (questIndex !== -1) {
                    // Set world progress to current quest position
                    document.getElementById('worldCurrent').value = questIndex;
                    document.getElementById('questText').value = selectedQuest;
                    updateOverlay();
                }
            }
        }

        function advanceToNextQuest() {
            const world = document.getElementById('worldSelect').value;
            if (!world) {
                console.log('No world selected');
                return;
            }
            if (!questDatabase[world]) {
                console.log('Quest database not loaded for world:', world);
                return;
            }

            const currentQuestText = document.getElementById('questText').value;
            const currentIndex = questDatabase[world].findIndex(q => {
                const qName = typeof q === 'string' ? q : q.name;
                return qName === currentQuestText;
            });

            console.log('Current quest:', currentQuestText, 'Index:', currentIndex, 'Total quests:', questDatabase[world].length);

            // If we found the current quest and there's a next one, advance
            if (currentIndex !== -1 && currentIndex < questDatabase[world].length - 1) {
                const nextQuest = questDatabase[world][currentIndex + 1];
                const nextQuestName = typeof nextQuest === 'string' ? nextQuest : nextQuest.name;
                
                console.log('Advancing to next quest:', nextQuestName);
                
                document.getElementById('worldCurrent').value = currentIndex + 1;
                document.getElementById('questText').value = nextQuestName;
                document.getElementById('questSelect').value = nextQuestName;
                updateOverlay();
            } else {
                console.log('Cannot advance - at end of quest list or quest not found');
            }
        }

        function goBackQuest() {
            const world = document.getElementById('worldSelect').value;
            if (!world) {
                console.log('No world selected');
                return;
            }
            if (!questDatabase[world]) {
                console.log('Quest database not loaded for world:', world);
                return;
            }

            const currentQuestText = document.getElementById('questText').value;
            const currentIndex = questDatabase[world].findIndex(q => {
                const qName = typeof q === 'string' ? q : q.name;
                return qName === currentQuestText;
            });

            console.log('Going back from quest:', currentQuestText, 'Index:', currentIndex);

            // If we found the current quest and there's a previous one, go back
            if (currentIndex > 0) {
                const prevQuest = questDatabase[world][currentIndex - 1];
                const prevQuestName = typeof prevQuest === 'string' ? prevQuest : prevQuest.name;
                
                console.log('Going back to previous quest:', prevQuestName);
                
                document.getElementById('worldCurrent').value = currentIndex - 1;
                document.getElementById('questText').value = prevQuestName;
                document.getElementById('questSelect').value = prevQuestName;
                updateOverlay();
            } else {
                console.log('Cannot go back - at beginning of quest list');
            }
        }

        // Load saved values from localStorage
        function loadSavedValues() {
            const saved = {
                worldName: localStorage.getItem('worldName') || 'Wizard City',
                worldCurrent: localStorage.getItem('worldCurrent') || '0',
                worldTotal: localStorage.getItem('worldTotal') || '39',
                totalCurrent: localStorage.getItem('totalCurrent') || '0',
                totalTotal: localStorage.getItem('totalTotal') || '100',
                questText: localStorage.getItem('questText') || 'Unicorn Way',
                counterText: localStorage.getItem('counterText') || 'Re-Rolls',
                counterNum: localStorage.getItem('counterNum') || '0'
            };

            // Set input values
            document.getElementById('worldSelect').value = saved.worldName;
            document.getElementById('worldCurrent').value = saved.worldCurrent;
            document.getElementById('worldTotal').value = saved.worldTotal;
            document.getElementById('totalCurrent').value = saved.totalCurrent;
            document.getElementById('totalTotal').value = saved.totalTotal;
            document.getElementById('questText').value = saved.questText;
            document.getElementById('counterText').value = saved.counterText;
            document.getElementById('counterNum').value = saved.counterNum;

            // Update display
            updateDisplay(saved);
        }

        function updateDisplay(data) {
            // Update world progress
            const worldPercent = Math.min(100, Math.round((data.worldCurrent / data.worldTotal) * 100));
            const questsLeft = Math.max(0, data.worldTotal - data.worldCurrent);
            document.getElementById('worldLabel').textContent = data.worldName + ' Progress';
            document.getElementById('worldPercentage').textContent = worldPercent + '% (' + questsLeft + ' left)';
            document.getElementById('worldBar').style.width = worldPercent + '%';
            document.getElementById('worldBarText').textContent = data.worldCurrent + '/' + data.worldTotal;

            // Update total progress
            const totalPercent = Math.min(100, Math.round((data.totalCurrent / data.totalTotal) * 100));
            document.getElementById('totalPercentage').textContent = totalPercent + '%';
            document.getElementById('totalBar').style.width = totalPercent + '%';
            document.getElementById('totalBarText').textContent = data.totalCurrent + '/' + data.totalTotal;

            // Update current quest with area and type
            let questDisplay = data.questText;
            const world = document.getElementById('worldSelect').value;
            if (world && questDatabase[world]) {
                const questObj = questDatabase[world].find(q => {
                    const qName = typeof q === 'string' ? q : q.name;
                    return qName === data.questText;
                });
                
                if (questObj && typeof questObj === 'object') {
                    let display = questObj.name;
                    if (questObj.area) {
                        display += '\n[' + questObj.area + ']';
                    }
                    if (questObj.type) {
                        display += '\n' + questObj.type;
                    }
                    questDisplay = display;
                }
            }
            document.getElementById('currentQuest').textContent = questDisplay;

            // Update counter
            document.getElementById('counterLabel').textContent = data.counterText + ':';
            document.getElementById('counterValue').textContent = data.counterNum;
        }

        function updateOverlay() {
            const data = {
                worldName: document.getElementById('worldSelect').value,
                worldCurrent: parseInt(document.getElementById('worldCurrent').value),
                worldTotal: parseInt(document.getElementById('worldTotal').value),
                totalCurrent: parseInt(document.getElementById('totalCurrent').value),
                totalTotal: parseInt(document.getElementById('totalTotal').value),
                questText: document.getElementById('questText').value,
                counterText: document.getElementById('counterText').value,
                counterNum: parseInt(document.getElementById('counterNum').value)
            };

            // Save to localStorage
            Object.keys(data).forEach(key => {
                localStorage.setItem(key, data[key]);
            });

            // Update display
            updateDisplay(data);
        }

        function toggleControls() {
            const controls = document.getElementById('controls');
            controls.style.display = controls.style.display === 'none' ? 'block' : 'none';
        }

        // Keyboard shortcuts for quick counter updates
        document.addEventListener('keydown', function(e) {
            // Press + or = to increment counter
            if (e.key === '+' || e.key === '=') {
                const counterInput = document.getElementById('counterNum');
                counterInput.value = parseInt(counterInput.value) + 1;
                updateOverlay();
                e.preventDefault();
            }
            // Press - to decrement counter
            if (e.key === '-') {
                const counterInput = document.getElementById('counterNum');
                counterInput.value = Math.max(0, parseInt(counterInput.value) - 1);
                updateOverlay();
                e.preventDefault();
            }
        });

        // Load saved values on page load
        window.addEventListener('load', async function() {
            await loadQuestData();
            loadSavedValues();
        });
    </script>
</body>
</html>
